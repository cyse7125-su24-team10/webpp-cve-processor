package main

import (
	"fmt"

	"github.com/cyse7125-su24-team10/webpp-cve-processor/config"
	"github.com/cyse7125-su24-team10/webpp-cve-processor/services/cveprocessor"
)

func main() {
	// postgresConn, err := db.GetPostgresConn()
	// if err != nil {
	// 	panic(err)
	// } else {
	// 	fmt.Println("connected to postgres")
	// }
	// fmt.Println(postgresConn)

	url := "https://github.com/CVEProject/cvelistV5/archive/refs/heads/main.zip"
	destDir := "./"

	filePath, err := cveprocessor.DownloadAndUnzip(url, destDir)
	if err != nil {
		fmt.Printf("Error: %v\n", err)
		return
	}

	fmt.Printf("File unzipped successfully. Path: %s\n", filePath)

	kafkaProducer := cveprocessor.NewKafkaProducer()
	brokers := []string{
		config.Envs.KafkaBroker0,
		config.Envs.KafkaBroker1,
		config.Envs.KafkaBroker2,
	}
	kafkaWriter, err := kafkaProducer.KafkaWriter(brokers)
	if err != nil {
		fmt.Printf("Error: %v\n", err)
	}

	fmt.Println("kafkaWriter", kafkaWriter)

	loadCVE := cveprocessor.NewLoadCVE()
	msg, err := loadCVE.LoadJsonData(kafkaWriter)
	if err != nil {
		panic(err)
	}
	fmt.Println(msg)
}
