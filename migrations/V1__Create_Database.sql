-- Ensure the schema name is correctly passed
DO $$
BEGIN
    -- Create schema if not exists
    EXECUTE 'CREATE SCHEMA IF NOT EXISTS cve';

    -- Set search path to the schema
    EXECUTE 'SET search_path TO cve';

    -- Check if the table exists before creating it
    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.tables 
        WHERE table_schema = 'cve' 
        AND table_name = 'CVE'
    )
    THEN
        -- Create the table if it does not exist
        EXECUTE 'CREATE TABLE cve.CVE (
            id VARCHAR(255) PRIMARY KEY,
            datatype VARCHAR(255),
            dataversion VARCHAR(255),
            cve_metadata JSONB,
            containers JSONB
        )';
    END IF;
END $$;
